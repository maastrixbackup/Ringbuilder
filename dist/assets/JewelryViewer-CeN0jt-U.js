import{r as Z,j as _e}from"./index-BW8zZP6E.js";import{M as yr,I as Nt,S as Sr,D as Bt,v as zr,b as Gr,H as Me,F as Oe,c as Ze,L as Re,R as tr,d as Dt,e as ke,f as Zr,g as kt,P as Wr,W as $r,U as hr,h as Lt,i as Pt,j as mr,T as We,k as Ht,l as zt,m as Gt,B as Zt,n as Wt,o as _r,p as ur,q as $t,r as Xt,s as Lr,t as Yt,N as Vt,V as Je,a as ar,w as vr,x as jt,E as qt,y as Kt,z as Jt,_ as Qt,A as ea,G as ra,J as ta,K as Pr,u as aa,C as na,O as ia}from"./OrbitControls-DIYzptlb.js";var Se=Uint8Array,Le=Uint16Array,wr=Uint32Array,Xr=new Se([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Yr=new Se([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),oa=new Se([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vr=function(i,t){for(var n=new Le(31),u=0;u<31;++u)n[u]=t+=1<<i[u-1];for(var c=new wr(n[30]),u=1;u<30;++u)for(var v=n[u];v<n[u+1];++v)c[v]=v-n[u]<<5|u;return[n,c]},jr=Vr(Xr,2),qr=jr[0],sa=jr[1];qr[28]=258,sa[258]=28;var la=Vr(Yr,0),ca=la[0],Er=new Le(32768);for(var ee=0;ee<32768;++ee){var De=(ee&43690)>>>1|(ee&21845)<<1;De=(De&52428)>>>2|(De&13107)<<2,De=(De&61680)>>>4|(De&3855)<<4,Er[ee]=((De&65280)>>>8|(De&255)<<8)>>>1}var rr=function(i,t,n){for(var u=i.length,c=0,v=new Le(t);c<u;++c)++v[i[c]-1];var h=new Le(t);for(c=0;c<t;++c)h[c]=h[c-1]+v[c-1]<<1;var y;if(n){y=new Le(1<<t);var g=15-t;for(c=0;c<u;++c)if(i[c])for(var f=c<<4|i[c],R=t-i[c],x=h[i[c]-1]++<<R,b=x|(1<<R)-1;x<=b;++x)y[Er[x]>>>g]=f}else for(y=new Le(u),c=0;c<u;++c)i[c]&&(y[c]=Er[h[i[c]-1]++]>>>15-i[c]);return y},ir=new Se(288);for(var ee=0;ee<144;++ee)ir[ee]=8;for(var ee=144;ee<256;++ee)ir[ee]=9;for(var ee=256;ee<280;++ee)ir[ee]=7;for(var ee=280;ee<288;++ee)ir[ee]=8;var Kr=new Se(32);for(var ee=0;ee<32;++ee)Kr[ee]=5;var ua=rr(ir,9,1),ha=rr(Kr,5,1),gr=function(i){for(var t=i[0],n=1;n<i.length;++n)i[n]>t&&(t=i[n]);return t},Te=function(i,t,n){var u=t/8|0;return(i[u]|i[u+1]<<8)>>(t&7)&n},fr=function(i,t){var n=t/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(t&7)},va=function(i){return(i/8|0)+(i&7&&1)},da=function(i,t,n){(n==null||n>i.length)&&(n=i.length);var u=new(i instanceof Le?Le:i instanceof wr?wr:Se)(n-t);return u.set(i.subarray(t,n)),u},pa=function(i,t,n){var u=i.length;if(!u||n&&!n.l&&u<5)return t||new Se(0);var c=!t||n,v=!n||n.i;n||(n={}),t||(t=new Se(u*3));var h=function(X){var Ae=t.length;if(X>Ae){var Fe=new Se(Math.max(Ae*2,X));Fe.set(t),t=Fe}},y=n.f||0,g=n.p||0,f=n.b||0,R=n.l,x=n.d,b=n.m,D=n.n,k=u*8;do{if(!R){n.f=y=Te(i,g,1);var le=Te(i,g+1,3);if(g+=3,le)if(le==1)R=ua,x=ha,b=9,D=5;else if(le==2){var se=Te(i,g,31)+257,ce=Te(i,g+10,15)+4,z=se+Te(i,g+5,31)+1;g+=14;for(var N=new Se(z),te=new Se(19),S=0;S<ce;++S)te[oa[S]]=Te(i,g+S*3,7);g+=ce*3;for(var I=gr(te),H=(1<<I)-1,$=rr(te,I,1),S=0;S<z;){var L=$[Te(i,g,H)];g+=L&15;var P=L>>>4;if(P<16)N[S++]=P;else{var G=0,A=0;for(P==16?(A=3+Te(i,g,3),g+=2,G=N[S-1]):P==17?(A=3+Te(i,g,7),g+=3):P==18&&(A=11+Te(i,g,127),g+=7);A--;)N[S++]=G}}var ae=N.subarray(0,se),O=N.subarray(se);b=gr(ae),D=gr(O),R=rr(ae,b,1),x=rr(O,D,1)}else throw"invalid block type";else{var P=va(g)+4,K=i[P-4]|i[P-3]<<8,re=P+K;if(re>u){if(v)throw"unexpected EOF";break}c&&h(f+K),t.set(i.subarray(P,re),f),n.b=f+=K,n.p=g=re*8;continue}if(g>k){if(v)throw"unexpected EOF";break}}c&&h(f+131072);for(var Ie=(1<<b)-1,Pe=(1<<D)-1,be=g;;be=g){var G=R[fr(i,g)&Ie],J=G>>>4;if(g+=G&15,g>k){if(v)throw"unexpected EOF";break}if(!G)throw"invalid length/literal";if(J<256)t[f++]=J;else if(J==256){be=g,R=null;break}else{var Ne=J-254;if(J>264){var S=J-257,ne=Xr[S];Ne=Te(i,g,(1<<ne)-1)+qr[S],g+=ne}var ve=x[fr(i,g)&Pe],Ce=ve>>>4;if(!ve)throw"invalid distance";g+=ve&15;var O=ca[Ce];if(Ce>3){var ne=Yr[Ce];O+=fr(i,g)&(1<<ne)-1,g+=ne}if(g>k){if(v)throw"unexpected EOF";break}c&&h(f+131072);for(var Xe=f+Ne;f<Xe;f+=4)t[f]=t[f-O],t[f+1]=t[f+1-O],t[f+2]=t[f+2-O],t[f+3]=t[f+3-O];f=Xe}}n.l=R,n.p=be,n.b=f,R&&(y=1,n.m=b,n.d=x,n.n=D)}while(!y);return f==t.length?t:da(t,0,f)},ga=new Se(0),fa=function(i){if((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)throw"invalid zlib data";if(i[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function lr(i,t){return pa((fa(i),i.subarray(2,-4)),t)}var ma=typeof TextDecoder<"u"&&new TextDecoder,_a=0;try{ma.decode(ga,{stream:!0}),_a=1}catch{}const wa=i=>i&&i.isCubeTexture;class Ea extends yr{constructor(t,n){var u,c;const v=wa(t),y=((c=v?(u=t.image[0])==null?void 0:u.width:t.image.width)!=null?c:1024)/4,g=Math.floor(Math.log2(y)),f=Math.pow(2,g),R=3*Math.max(f,16*7),x=4*f,b=[v?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/R}`,`#define CUBEUV_TEXEL_HEIGHT ${1/x}`,`#define CUBEUV_MAX_MIP ${g}.0`],D=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,k=b.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${zr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,le={map:{value:t},height:{value:n?.height||15},radius:{value:n?.radius||100}},P=new Nt(1,16),K=new Sr({uniforms:le,fragmentShader:k,vertexShader:D,side:Bt});super(P,K)}set radius(t){this.material.uniforms.radius.value=t}get radius(){return this.material.uniforms.radius.value}set height(t){this.material.uniforms.height.value=t}get height(){return this.material.uniforms.height.value}}class ya extends Gr{constructor(t){super(t),this.type=Me}parse(t){const h=function(S,I){switch(S){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(I||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(I||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(I||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(I||""))}},R=`
`,x=function(S,I,H){I=I||1024;let L=S.pos,G=-1,A=0,ae="",O=String.fromCharCode.apply(null,new Uint16Array(S.subarray(L,L+128)));for(;0>(G=O.indexOf(R))&&A<I&&L<S.byteLength;)ae+=O,A+=O.length,L+=128,O+=String.fromCharCode.apply(null,new Uint16Array(S.subarray(L,L+128)));return-1<G?(S.pos+=A+G+1,ae+O.slice(0,G)):!1},b=function(S){const I=/^#\?(\S+)/,H=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,$=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,L=/^\s*FORMAT=(\S+)\s*$/,G=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,A={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ae,O;for((S.pos>=S.byteLength||!(ae=x(S)))&&h(1,"no header found"),(O=ae.match(I))||h(3,"bad initial token"),A.valid|=1,A.programtype=O[1],A.string+=ae+`
`;ae=x(S),ae!==!1;){if(A.string+=ae+`
`,ae.charAt(0)==="#"){A.comments+=ae+`
`;continue}if((O=ae.match(H))&&(A.gamma=parseFloat(O[1])),(O=ae.match($))&&(A.exposure=parseFloat(O[1])),(O=ae.match(L))&&(A.valid|=2,A.format=O[1]),(O=ae.match(G))&&(A.valid|=4,A.height=parseInt(O[1],10),A.width=parseInt(O[2],10)),A.valid&2&&A.valid&4)break}return A.valid&2||h(3,"missing format specifier"),A.valid&4||h(3,"missing image size specifier"),A},D=function(S,I,H){const $=I;if($<8||$>32767||S[0]!==2||S[1]!==2||S[2]&128)return new Uint8Array(S);$!==(S[2]<<8|S[3])&&h(3,"wrong scanline width");const L=new Uint8Array(4*I*H);L.length||h(4,"unable to allocate buffer space");let G=0,A=0;const ae=4*$,O=new Uint8Array(4),Ie=new Uint8Array(ae);let Pe=H;for(;Pe>0&&A<S.byteLength;){A+4>S.byteLength&&h(1),O[0]=S[A++],O[1]=S[A++],O[2]=S[A++],O[3]=S[A++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=$)&&h(3,"bad rgbe scanline format");let be=0,J;for(;be<ae&&A<S.byteLength;){J=S[A++];const ne=J>128;if(ne&&(J-=128),(J===0||be+J>ae)&&h(3,"bad scanline data"),ne){const ve=S[A++];for(let Ce=0;Ce<J;Ce++)Ie[be++]=ve}else Ie.set(S.subarray(A,A+J),be),be+=J,A+=J}const Ne=$;for(let ne=0;ne<Ne;ne++){let ve=0;L[G]=Ie[ne+ve],ve+=$,L[G+1]=Ie[ne+ve],ve+=$,L[G+2]=Ie[ne+ve],ve+=$,L[G+3]=Ie[ne+ve],G+=4}Pe--}return L},k=function(S,I,H,$){const L=S[I+3],G=Math.pow(2,L-128)/255;H[$+0]=S[I+0]*G,H[$+1]=S[I+1]*G,H[$+2]=S[I+2]*G,H[$+3]=1},le=function(S,I,H,$){const L=S[I+3],G=Math.pow(2,L-128)/255;H[$+0]=Ze.toHalfFloat(Math.min(S[I+0]*G,65504)),H[$+1]=Ze.toHalfFloat(Math.min(S[I+1]*G,65504)),H[$+2]=Ze.toHalfFloat(Math.min(S[I+2]*G,65504)),H[$+3]=Ze.toHalfFloat(1)},P=new Uint8Array(t);P.pos=0;const K=b(P),re=K.width,se=K.height,ce=D(P.subarray(P.pos),re,se);let z,N,te;switch(this.type){case Oe:te=ce.length/4;const S=new Float32Array(te*4);for(let H=0;H<te;H++)k(ce,H*4,S,H*4);z=S,N=Oe;break;case Me:te=ce.length/4;const I=new Uint16Array(te*4);for(let H=0;H<te;H++)le(ce,H*4,I,H*4);z=I,N=Me;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:re,height:se,data:z,header:K.string,gamma:K.gamma,exposure:K.exposure,type:N}}setDataType(t){return this.type=t,this}load(t,n,u,c){function v(h,y){switch(h.type){case Oe:case Me:"colorSpace"in h?h.colorSpace="srgb-linear":h.encoding=3e3,h.minFilter=Re,h.magFilter=Re,h.generateMipmaps=!1,h.flipY=!0;break}n&&n(h,y)}return super.load(t,v,u,c)}}const Qe=zr>=152;class Sa extends Gr{constructor(t){super(t),this.type=Me}parse(t){const I=Math.pow(2.7182818,2.2);function H(e,r){for(var a=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(r[a++]=o);for(var s=a-1;a<65536;)r[a++]=0;return s}function $(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}const L={l:0,c:0,lc:0};function G(e,r,a,o,s){for(;a<e;)r=r<<8|Dr(o,s),a+=8;a-=e,L.l=r>>a&(1<<e)-1,L.c=r,L.lc=a}const A=new Array(59);function ae(e){for(var r=0;r<=58;++r)A[r]=0;for(var r=0;r<65537;++r)A[e[r]]+=1;for(var a=0,r=58;r>0;--r){var o=a+A[r]>>1;A[r]=a,a=o}for(var r=0;r<65537;++r){var s=e[r];s>0&&(e[r]=s|A[s]++<<6)}}function O(e,r,a,o,s,l,p){for(var d=a,w=0,_=0;s<=l;s++){if(d.value-a.value>o)return!1;G(6,w,_,e,d);var E=L.l;if(w=L.c,_=L.lc,p[s]=E,E==63){if(d.value-a.value>o)throw"Something wrong with hufUnpackEncTable";G(8,w,_,e,d);var m=L.l+6;if(w=L.c,_=L.lc,s+m>l+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)p[s++]=0;s--}else if(E>=59){var m=E-59+2;if(s+m>l+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)p[s++]=0;s--}}ae(p)}function Ie(e){return e&63}function Pe(e){return e>>6}function be(e,r,a,o){for(;r<=a;r++){var s=Pe(e[r]),l=Ie(e[r]);if(s>>l)throw"Invalid table entry";if(l>14){var p=o[s>>l-14];if(p.len)throw"Invalid table entry";if(p.lit++,p.p){var d=p.p;p.p=new Array(p.lit);for(var w=0;w<p.lit-1;++w)p.p[w]=d[w]}else p.p=new Array(1);p.p[p.lit-1]=r}else if(l)for(var _=0,w=1<<14-l;w>0;w--){var p=o[(s<<14-l)+_];if(p.len||p.p)throw"Invalid table entry";p.len=l,p.lit=r,_++}}return!0}const J={c:0,lc:0};function Ne(e,r,a,o){e=e<<8|Dr(a,o),r+=8,J.c=e,J.lc=r}const ne={c:0,lc:0};function ve(e,r,a,o,s,l,p,d,w,_){if(e==r){o<8&&(Ne(a,o,s,p),a=J.c,o=J.lc),o-=8;var E=a>>o,E=new Uint8Array([E])[0];if(w.value+E>_)return!1;for(var m=d[w.value-1];E-- >0;)d[w.value++]=m}else if(w.value<_)d[w.value++]=e;else return!1;ne.c=a,ne.lc=o}function Ce(e){return e&65535}function Xe(e){var r=Ce(e);return r>32767?r-65536:r}const X={a:0,b:0};function Ae(e,r){var a=Xe(e),o=Xe(r),s=o,l=a+(s&1)+(s>>1),p=l,d=l-s;X.a=p,X.b=d}function Fe(e,r){var a=Ce(e),o=Ce(r),s=a-(o>>1)&65535,l=o+s-32768&65535;X.a=l,X.b=s}function nt(e,r,a,o,s,l,p){for(var d=p<16384,w=a>s?s:a,_=1,E;_<=w;)_<<=1;for(_>>=1,E=_,_>>=1;_>=1;){for(var m=0,oe=m+l*(s-E),T=l*_,C=l*E,F=o*_,U=o*E,Y,j,ue,ge;m<=oe;m+=C){for(var q=m,xe=m+o*(a-E);q<=xe;q+=U){var Q=q+F,he=q+T,Ue=he+F;d?(Ae(e[q+r],e[he+r]),Y=X.a,ue=X.b,Ae(e[Q+r],e[Ue+r]),j=X.a,ge=X.b,Ae(Y,j),e[q+r]=X.a,e[Q+r]=X.b,Ae(ue,ge),e[he+r]=X.a,e[Ue+r]=X.b):(Fe(e[q+r],e[he+r]),Y=X.a,ue=X.b,Fe(e[Q+r],e[Ue+r]),j=X.a,ge=X.b,Fe(Y,j),e[q+r]=X.a,e[Q+r]=X.b,Fe(ue,ge),e[he+r]=X.a,e[Ue+r]=X.b)}if(a&_){var he=q+T;d?Ae(e[q+r],e[he+r]):Fe(e[q+r],e[he+r]),Y=X.a,e[he+r]=X.b,e[q+r]=Y}}if(s&_)for(var q=m,xe=m+o*(a-E);q<=xe;q+=U){var Q=q+F;d?Ae(e[q+r],e[Q+r]):Fe(e[q+r],e[Q+r]),Y=X.a,e[Q+r]=X.b,e[q+r]=Y}E=_,_>>=1}return m}function it(e,r,a,o,s,l,p,d,w,_){for(var E=0,m=0,oe=d,T=Math.trunc(s.value+(l+7)/8);s.value<T;)for(Ne(E,m,a,s),E=J.c,m=J.lc;m>=14;){var C=E>>m-14&16383,F=r[C];if(F.len)m-=F.len,ve(F.lit,p,E,m,a,o,s,w,_,oe),E=ne.c,m=ne.lc;else{if(!F.p)throw"hufDecode issues";var U;for(U=0;U<F.lit;U++){for(var Y=Ie(e[F.p[U]]);m<Y&&s.value<T;)Ne(E,m,a,s),E=J.c,m=J.lc;if(m>=Y&&Pe(e[F.p[U]])==(E>>m-Y&(1<<Y)-1)){m-=Y,ve(F.p[U],p,E,m,a,o,s,w,_,oe),E=ne.c,m=ne.lc;break}}if(U==F.lit)throw"hufDecode issues"}}var j=8-l&7;for(E>>=j,m-=j;m>0;){var F=r[E<<14-m&16383];if(F.len)m-=F.len,ve(F.lit,p,E,m,a,o,s,w,_,oe),E=ne.c,m=ne.lc;else throw"hufDecode issues"}return!0}function Ar(e,r,a,o,s,l){var p={value:0},d=a.value,w=fe(r,a),_=fe(r,a);a.value+=4;var E=fe(r,a);if(a.value+=4,w<0||w>=65537||_<0||_>=65537)throw"Something wrong with HUF_ENCSIZE";var m=new Array(65537),oe=new Array(16384);$(oe);var T=o-(a.value-d);if(O(e,r,a,T,w,_,m),E>8*(o-(a.value-d)))throw"Something wrong with hufUncompress";be(m,w,_,oe),it(m,oe,e,r,a,E,_,l,s,p)}function ot(e,r,a){for(var o=0;o<a;++o)r[o]=e[r[o]]}function Fr(e){for(var r=1;r<e.length;r++){var a=e[r-1]+e[r]-128;e[r]=a}}function Ur(e,r){for(var a=0,o=Math.floor((e.length+1)/2),s=0,l=e.length-1;!(s>l||(r[s++]=e[a++],s>l));)r[s++]=e[o++]}function Or(e){for(var r=e.byteLength,a=new Array,o=0,s=new DataView(e);r>0;){var l=s.getInt8(o++);if(l<0){var p=-l;r-=p+1;for(var d=0;d<p;d++)a.push(s.getUint8(o++))}else{var p=l;r-=2;for(var w=s.getUint8(o++),d=0;d<p+1;d++)a.push(w)}}return a}function st(e,r,a,o,s,l){var Q=new DataView(l.buffer),p=a[e.idx[0]].width,d=a[e.idx[0]].height,w=3,_=Math.floor(p/8),E=Math.ceil(p/8),m=Math.ceil(d/8),oe=p-(E-1)*8,T=d-(m-1)*8,C={value:0},F=new Array(w),U=new Array(w),Y=new Array(w),j=new Array(w),ue=new Array(w);for(let V=0;V<w;++V)ue[V]=r[e.idx[V]],F[V]=V<1?0:F[V-1]+E*m,U[V]=new Float32Array(64),Y[V]=new Uint16Array(64),j[V]=new Uint16Array(E*64);for(let V=0;V<m;++V){var ge=8;V==m-1&&(ge=T);var q=8;for(let ie=0;ie<E;++ie){ie==E-1&&(q=oe);for(let W=0;W<w;++W)Y[W].fill(0),Y[W][0]=s[F[W]++],lt(C,o,Y[W]),ct(Y[W],U[W]),ut(U[W]);ht(U);for(let W=0;W<w;++W)vt(U[W],j[W],ie*64)}let pe=0;for(let ie=0;ie<w;++ie){const W=a[e.idx[ie]].type;for(let ye=8*V;ye<8*V+ge;++ye){pe=ue[ie][ye];for(let He=0;He<_;++He){const me=He*64+(ye&7)*8;Q.setUint16(pe+0*2*W,j[ie][me+0],!0),Q.setUint16(pe+1*2*W,j[ie][me+1],!0),Q.setUint16(pe+2*2*W,j[ie][me+2],!0),Q.setUint16(pe+3*2*W,j[ie][me+3],!0),Q.setUint16(pe+4*2*W,j[ie][me+4],!0),Q.setUint16(pe+5*2*W,j[ie][me+5],!0),Q.setUint16(pe+6*2*W,j[ie][me+6],!0),Q.setUint16(pe+7*2*W,j[ie][me+7],!0),pe+=8*2*W}}if(_!=E)for(let ye=8*V;ye<8*V+ge;++ye){const He=ue[ie][ye]+8*_*2*W,me=_*64+(ye&7)*8;for(let Be=0;Be<q;++Be)Q.setUint16(He+Be*2*W,j[ie][me+Be],!0)}}}for(var xe=new Uint16Array(p),Q=new DataView(l.buffer),he=0;he<w;++he){a[e.idx[he]].decoded=!0;var Ue=a[e.idx[he]].type;if(a[he].type==2)for(var Ke=0;Ke<d;++Ke){const V=ue[he][Ke];for(var Ee=0;Ee<p;++Ee)xe[Ee]=Q.getUint16(V+Ee*2*Ue,!0);for(var Ee=0;Ee<p;++Ee)Q.setFloat32(V+Ee*2*Ue,M(xe[Ee]),!0)}}}function lt(e,r,a){for(var o,s=1;s<64;)o=r[e.value],o==65280?s=64:o>>8==255?s+=o&255:(a[s]=o,s++),e.value++}function ct(e,r){r[0]=M(e[0]),r[1]=M(e[1]),r[2]=M(e[5]),r[3]=M(e[6]),r[4]=M(e[14]),r[5]=M(e[15]),r[6]=M(e[27]),r[7]=M(e[28]),r[8]=M(e[2]),r[9]=M(e[4]),r[10]=M(e[7]),r[11]=M(e[13]),r[12]=M(e[16]),r[13]=M(e[26]),r[14]=M(e[29]),r[15]=M(e[42]),r[16]=M(e[3]),r[17]=M(e[8]),r[18]=M(e[12]),r[19]=M(e[17]),r[20]=M(e[25]),r[21]=M(e[30]),r[22]=M(e[41]),r[23]=M(e[43]),r[24]=M(e[9]),r[25]=M(e[11]),r[26]=M(e[18]),r[27]=M(e[24]),r[28]=M(e[31]),r[29]=M(e[40]),r[30]=M(e[44]),r[31]=M(e[53]),r[32]=M(e[10]),r[33]=M(e[19]),r[34]=M(e[23]),r[35]=M(e[32]),r[36]=M(e[39]),r[37]=M(e[45]),r[38]=M(e[52]),r[39]=M(e[54]),r[40]=M(e[20]),r[41]=M(e[22]),r[42]=M(e[33]),r[43]=M(e[38]),r[44]=M(e[46]),r[45]=M(e[51]),r[46]=M(e[55]),r[47]=M(e[60]),r[48]=M(e[21]),r[49]=M(e[34]),r[50]=M(e[37]),r[51]=M(e[47]),r[52]=M(e[50]),r[53]=M(e[56]),r[54]=M(e[59]),r[55]=M(e[61]),r[56]=M(e[35]),r[57]=M(e[36]),r[58]=M(e[48]),r[59]=M(e[49]),r[60]=M(e[57]),r[61]=M(e[58]),r[62]=M(e[62]),r[63]=M(e[63])}function ut(e){const r=.5*Math.cos(.7853975),a=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),s=.5*Math.cos(3*3.14159/16),l=.5*Math.cos(5*3.14159/16),p=.5*Math.cos(3*3.14159/8),d=.5*Math.cos(7*3.14159/16);for(var w=new Array(4),_=new Array(4),E=new Array(4),m=new Array(4),oe=0;oe<8;++oe){var T=oe*8;w[0]=o*e[T+2],w[1]=p*e[T+2],w[2]=o*e[T+6],w[3]=p*e[T+6],_[0]=a*e[T+1]+s*e[T+3]+l*e[T+5]+d*e[T+7],_[1]=s*e[T+1]-d*e[T+3]-a*e[T+5]-l*e[T+7],_[2]=l*e[T+1]-a*e[T+3]+d*e[T+5]+s*e[T+7],_[3]=d*e[T+1]-l*e[T+3]+s*e[T+5]-a*e[T+7],E[0]=r*(e[T+0]+e[T+4]),E[3]=r*(e[T+0]-e[T+4]),E[1]=w[0]+w[3],E[2]=w[1]-w[2],m[0]=E[0]+E[1],m[1]=E[3]+E[2],m[2]=E[3]-E[2],m[3]=E[0]-E[1],e[T+0]=m[0]+_[0],e[T+1]=m[1]+_[1],e[T+2]=m[2]+_[2],e[T+3]=m[3]+_[3],e[T+4]=m[3]-_[3],e[T+5]=m[2]-_[2],e[T+6]=m[1]-_[1],e[T+7]=m[0]-_[0]}for(var C=0;C<8;++C)w[0]=o*e[16+C],w[1]=p*e[16+C],w[2]=o*e[48+C],w[3]=p*e[48+C],_[0]=a*e[8+C]+s*e[24+C]+l*e[40+C]+d*e[56+C],_[1]=s*e[8+C]-d*e[24+C]-a*e[40+C]-l*e[56+C],_[2]=l*e[8+C]-a*e[24+C]+d*e[40+C]+s*e[56+C],_[3]=d*e[8+C]-l*e[24+C]+s*e[40+C]-a*e[56+C],E[0]=r*(e[C]+e[32+C]),E[3]=r*(e[C]-e[32+C]),E[1]=w[0]+w[3],E[2]=w[1]-w[2],m[0]=E[0]+E[1],m[1]=E[3]+E[2],m[2]=E[3]-E[2],m[3]=E[0]-E[1],e[0+C]=m[0]+_[0],e[8+C]=m[1]+_[1],e[16+C]=m[2]+_[2],e[24+C]=m[3]+_[3],e[32+C]=m[3]-_[3],e[40+C]=m[2]-_[2],e[48+C]=m[1]-_[1],e[56+C]=m[0]-_[0]}function ht(e){for(var r=0;r<64;++r){var a=e[0][r],o=e[1][r],s=e[2][r];e[0][r]=a+1.5747*s,e[1][r]=a-.1873*o-.4682*s,e[2][r]=a+1.8556*o}}function vt(e,r,a){for(var o=0;o<64;++o)r[a+o]=Ze.toHalfFloat(dt(e[o]))}function dt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(I,Math.abs(e)-1)}function Nr(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function pt(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),a=new Uint8Array(Or(r)),o=new Uint8Array(a.length);return Fr(a),Ur(a,o),new DataView(o.buffer)}function pr(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=lr(r),o=new Uint8Array(a.length);return Fr(a),Ur(a,o),new DataView(o.buffer)}function gt(e){for(var r=e.viewer,a={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),s=new Uint8Array(8192),l=0,p=new Array(e.channels),d=0;d<e.channels;d++)p[d]={},p[d].start=l,p[d].end=p[d].start,p[d].nx=e.width,p[d].ny=e.lines,p[d].size=e.type,l+=p[d].nx*p[d].ny*p[d].size;var w=Ve(r,a),_=Ve(r,a);if(_>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(w<=_)for(var d=0;d<_-w+1;d++)s[d+w]=ze(r,a);var E=new Uint16Array(65536),m=H(s,E),oe=fe(r,a);Ar(e.array,r,a,oe,o,l);for(var d=0;d<e.channels;++d)for(var T=p[d],C=0;C<p[d].size;++C)nt(o,T.start+C,T.nx,T.size,T.ny,T.nx*T.size,m);ot(E,o,l);for(var F=0,U=new Uint8Array(o.buffer.byteLength),Y=0;Y<e.lines;Y++)for(var j=0;j<e.channels;j++){var T=p[j],ue=T.nx*T.size,ge=new Uint8Array(o.buffer,T.end*2,ue*2);U.set(ge,F),F+=ue*2,T.end+=ue}return new DataView(U.buffer)}function ft(e){var r=e.array.slice(e.offset.value,e.offset.value+e.size),a=lr(r);const o=e.lines*e.channels*e.width,s=e.type==1?new Uint16Array(o):new Uint32Array(o);let l=0,p=0;const d=new Array(4);for(let w=0;w<e.lines;w++)for(let _=0;_<e.channels;_++){let E=0;switch(e.type){case 1:d[0]=l,d[1]=d[0]+e.width,l=d[1]+e.width;for(let m=0;m<e.width;++m){const oe=a[d[0]++]<<8|a[d[1]++];E+=oe,s[p]=E,p++}break;case 2:d[0]=l,d[1]=d[0]+e.width,d[2]=d[1]+e.width,l=d[2]+e.width;for(let m=0;m<e.width;++m){const oe=a[d[0]++]<<24|a[d[1]++]<<16|a[d[2]++]<<8;E+=oe,s[p]=E,p++}break}}return new DataView(s.buffer)}function Br(e){var r=e.viewer,a={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),s={version:we(r,a),unknownUncompressedSize:we(r,a),unknownCompressedSize:we(r,a),acCompressedSize:we(r,a),dcCompressedSize:we(r,a),rleCompressedSize:we(r,a),rleUncompressedSize:we(r,a),rleRawSize:we(r,a),totalAcUncompressedCount:we(r,a),totalDcUncompressedCount:we(r,a),acCompression:we(r,a)};if(s.version<2)throw"EXRLoader.parse: "+qe.compression+" version "+s.version+" is unsupported";for(var l=new Array,p=Ve(r,a)-2;p>0;){var d=or(r.buffer,a),w=ze(r,a),_=w>>2&3,E=(w>>4)-1,m=new Int8Array([E])[0],oe=ze(r,a);l.push({name:d,index:m,type:oe,compression:_}),p-=d.length+3}for(var T=qe.channels,C=new Array(e.channels),F=0;F<e.channels;++F){var U=C[F]={},Y=T[F];U.name=Y.name,U.compression=0,U.decoded=!1,U.type=Y.pixelType,U.pLinear=Y.pLinear,U.width=e.width,U.height=e.lines}for(var j={idx:new Array(3)},ue=0;ue<e.channels;++ue)for(var U=C[ue],F=0;F<l.length;++F){var ge=l[F];U.name==ge.name&&(U.compression=ge.compression,ge.index>=0&&(j.idx[ge.index]=ue),U.offset=ue)}if(s.acCompressedSize>0)switch(s.acCompression){case 0:var Q=new Uint16Array(s.totalAcUncompressedCount);Ar(e.array,r,a,s.acCompressedSize,Q,s.totalAcUncompressedCount);break;case 1:var q=e.array.slice(a.value,a.value+s.totalAcUncompressedCount),xe=lr(q),Q=new Uint16Array(xe.buffer);a.value+=s.totalAcUncompressedCount;break}if(s.dcCompressedSize>0){var he={array:e.array,offset:a,size:s.dcCompressedSize},Ue=new Uint16Array(pr(he).buffer);a.value+=s.dcCompressedSize}if(s.rleRawSize>0){var q=e.array.slice(a.value,a.value+s.rleCompressedSize),xe=lr(q),Ke=Or(xe.buffer);a.value+=s.rleCompressedSize}for(var Ee=0,V=new Array(C.length),F=0;F<V.length;++F)V[F]=new Array;for(var pe=0;pe<e.lines;++pe)for(var ie=0;ie<C.length;++ie)V[ie].push(Ee),Ee+=C[ie].width*e.type*2;st(j,V,C,Q,Ue,o);for(var F=0;F<C.length;++F){var U=C[F];if(!U.decoded)switch(U.compression){case 2:for(var W=0,ye=0,pe=0;pe<e.lines;++pe){for(var He=V[F][W],me=0;me<U.width;++me){for(var Be=0;Be<2*U.type;++Be)o[He++]=Ke[ye+Be*U.width*U.height];ye++}W++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function or(e,r){for(var a=new Uint8Array(e),o=0;a[r.value+o]!=0;)o+=1;var s=new TextDecoder().decode(a.slice(r.value,r.value+o));return r.value=r.value+o+1,s}function mt(e,r,a){var o=new TextDecoder().decode(new Uint8Array(e).slice(r.value,r.value+a));return r.value=r.value+a,o}function _t(e,r){var a=Ye(e,r),o=fe(e,r);return[a,o]}function wt(e,r){var a=fe(e,r),o=fe(e,r);return[a,o]}function Ye(e,r){var a=e.getInt32(r.value,!0);return r.value=r.value+4,a}function fe(e,r){var a=e.getUint32(r.value,!0);return r.value=r.value+4,a}function Dr(e,r){var a=e[r.value];return r.value=r.value+1,a}function ze(e,r){var a=e.getUint8(r.value);return r.value=r.value+1,a}const we=function(e,r){let a;return"getBigInt64"in DataView.prototype?a=Number(e.getBigInt64(r.value,!0)):a=e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,a};function de(e,r){var a=e.getFloat32(r.value,!0);return r.value+=4,a}function Et(e,r){return Ze.toHalfFloat(de(e,r))}function M(e){var r=(e&31744)>>10,a=e&1023;return(e>>15?-1:1)*(r?r===31?a?NaN:1/0:Math.pow(2,r-15)*(1+a/1024):6103515625e-14*(a/1024))}function Ve(e,r){var a=e.getUint16(r.value,!0);return r.value+=2,a}function yt(e,r){return M(Ve(e,r))}function St(e,r,a,o){for(var s=a.value,l=[];a.value<s+o-1;){var p=or(r,a),d=Ye(e,a),w=ze(e,a);a.value+=3;var _=Ye(e,a),E=Ye(e,a);l.push({name:p,pixelType:d,pLinear:w,xSampling:_,ySampling:E})}return a.value+=1,l}function Mt(e,r){var a=de(e,r),o=de(e,r),s=de(e,r),l=de(e,r),p=de(e,r),d=de(e,r),w=de(e,r),_=de(e,r);return{redX:a,redY:o,greenX:s,greenY:l,blueX:p,blueY:d,whiteX:w,whiteY:_}}function It(e,r){var a=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=ze(e,r);return a[o]}function bt(e,r){var a=fe(e,r),o=fe(e,r),s=fe(e,r),l=fe(e,r);return{xMin:a,yMin:o,xMax:s,yMax:l}}function Tt(e,r){var a=["INCREASING_Y"],o=ze(e,r);return a[o]}function Ct(e,r){var a=de(e,r),o=de(e,r);return[a,o]}function xt(e,r){var a=de(e,r),o=de(e,r),s=de(e,r);return[a,o,s]}function Rt(e,r,a,o,s){if(o==="string"||o==="stringvector"||o==="iccProfile")return mt(r,a,s);if(o==="chlist")return St(e,r,a,s);if(o==="chromaticities")return Mt(e,a);if(o==="compression")return It(e,a);if(o==="box2i")return bt(e,a);if(o==="lineOrder")return Tt(e,a);if(o==="float")return de(e,a);if(o==="v2f")return Ct(e,a);if(o==="v3f")return xt(e,a);if(o==="int")return Ye(e,a);if(o==="rational")return _t(e,a);if(o==="timecode")return wt(e,a);if(o==="preview")return a.value+=s,"skipped";a.value+=s}function At(e,r,a){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const s=e.getUint8(5);o.spec={singleTile:!!(s&2),longName:!!(s&4),deepFormat:!!(s&8),multiPart:!!(s&16)},a.value=8;for(var l=!0;l;){var p=or(r,a);if(p==0)l=!1;else{var d=or(r,a),w=fe(e,a),_=Rt(e,r,a,d,w);_===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${d}'.`):o[p]=_}}if((s&-5)!=0)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function Ft(e,r,a,o,s){const l={size:0,viewer:r,array:a,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Qe?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":l.lines=1,l.uncompress=Nr;break;case"RLE_COMPRESSION":l.lines=1,l.uncompress=pt;break;case"ZIPS_COMPRESSION":l.lines=1,l.uncompress=pr;break;case"ZIP_COMPRESSION":l.lines=16,l.uncompress=pr;break;case"PIZ_COMPRESSION":l.lines=32,l.uncompress=gt;break;case"PXR24_COMPRESSION":l.lines=16,l.uncompress=ft;break;case"DWAA_COMPRESSION":l.lines=32,l.uncompress=Br;break;case"DWAB_COMPRESSION":l.lines=256,l.uncompress=Br;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(l.scanlineBlockSize=l.lines,l.type==1)switch(s){case Oe:l.getter=yt,l.inputSize=2;break;case Me:l.getter=Ve,l.inputSize=2;break}else if(l.type==2)switch(s){case Oe:l.getter=de,l.inputSize=4;break;case Me:l.getter=Et,l.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+l.type+" for "+e.compression+".";l.blockCount=(e.dataWindow.yMax+1)/l.scanlineBlockSize;for(var p=0;p<l.blockCount;p++)we(r,o);l.outputChannels=l.channels==3?4:l.channels;const d=l.width*l.height*l.outputChannels;switch(s){case Oe:l.byteArray=new Float32Array(d),l.channels<l.outputChannels&&l.byteArray.fill(1,0,d);break;case Me:l.byteArray=new Uint16Array(d),l.channels<l.outputChannels&&l.byteArray.fill(15360,0,d);break;default:console.error("THREE.EXRLoader: unsupported type: ",s);break}return l.bytesPerLine=l.width*l.inputSize*l.channels,l.outputChannels==4?l.format=tr:l.format=Dt,Qe?l.colorSpace="srgb-linear":l.encoding=3e3,l}const sr=new DataView(t),Ut=new Uint8Array(t),je={value:0},qe=At(sr,t,je),B=Ft(qe,sr,Ut,je,this.type),kr={value:0},Ot={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<B.height/B.scanlineBlockSize;e++){const r=fe(sr,je);B.size=fe(sr,je),B.lines=r+B.scanlineBlockSize>B.height?B.height-r:B.scanlineBlockSize;const o=B.size<B.lines*B.bytesPerLine?B.uncompress(B):Nr(B);je.value+=B.size;for(let s=0;s<B.scanlineBlockSize;s++){const l=s+e*B.scanlineBlockSize;if(l>=B.height)break;for(let p=0;p<B.channels;p++){const d=Ot[qe.channels[p].name];for(let w=0;w<B.width;w++){kr.value=(s*(B.channels*B.width)+p*B.width+w)*B.inputSize;const _=(B.height-1-l)*(B.width*B.outputChannels)+w*B.outputChannels+d;B.byteArray[_]=B.getter(o,kr)}}}}return{header:qe,width:B.width,height:B.height,data:B.byteArray,format:B.format,[Qe?"colorSpace":"encoding"]:B[Qe?"colorSpace":"encoding"],type:this.type}}setDataType(t){return this.type=t,this}load(t,n,u,c){function v(h,y){Qe?h.colorSpace=y.colorSpace:h.encoding=y.encoding,h.minFilter=Re,h.magFilter=Re,h.generateMipmaps=!1,h.flipY=!1,n&&n(h,y)}return super.load(t,v,u,c)}}const Jr=(i,t,n)=>{let u;switch(i){case _r:u=new Uint8ClampedArray(t*n*4);break;case Me:u=new Uint16Array(t*n*4);break;case Wt:u=new Uint32Array(t*n*4);break;case Zt:u=new Int8Array(t*n*4);break;case Gt:u=new Int16Array(t*n*4);break;case zt:u=new Int32Array(t*n*4);break;case Oe:u=new Float32Array(t*n*4);break;default:throw new Error("Unsupported data type")}return u};let cr;const Ma=(i,t,n,u)=>{if(cr!==void 0)return cr;const c=new $r(1,1,u);t.setRenderTarget(c);const v=new yr(new Wr,new Ht({color:16777215}));t.render(v,n),t.setRenderTarget(null);const h=Jr(i,c.width,c.height);return t.readRenderTargetPixels(c,0,0,c.width,c.height,h),c.dispose(),v.geometry.dispose(),v.material.dispose(),cr=h[0]!==0,cr};class Mr{constructor(t){var n,u,c,v,h,y,g,f,R,x,b,D,k,le,P,K;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(se){throw this._renderer.setRenderTarget(null),se}this._renderer.setRenderTarget(null)},this._width=t.width,this._height=t.height,this._type=t.type,this._colorSpace=t.colorSpace;const re={format:tr,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((n=t.renderTargetOptions)===null||n===void 0?void 0:n.anisotropy)!==void 0?(u=t.renderTargetOptions)===null||u===void 0?void 0:u.anisotropy:1,generateMipmaps:((c=t.renderTargetOptions)===null||c===void 0?void 0:c.generateMipmaps)!==void 0?(v=t.renderTargetOptions)===null||v===void 0?void 0:v.generateMipmaps:!1,magFilter:((h=t.renderTargetOptions)===null||h===void 0?void 0:h.magFilter)!==void 0?(y=t.renderTargetOptions)===null||y===void 0?void 0:y.magFilter:Re,minFilter:((g=t.renderTargetOptions)===null||g===void 0?void 0:g.minFilter)!==void 0?(f=t.renderTargetOptions)===null||f===void 0?void 0:f.minFilter:Re,samples:((R=t.renderTargetOptions)===null||R===void 0?void 0:R.samples)!==void 0?(x=t.renderTargetOptions)===null||x===void 0?void 0:x.samples:void 0,wrapS:((b=t.renderTargetOptions)===null||b===void 0?void 0:b.wrapS)!==void 0?(D=t.renderTargetOptions)===null||D===void 0?void 0:D.wrapS:ke,wrapT:((k=t.renderTargetOptions)===null||k===void 0?void 0:k.wrapT)!==void 0?(le=t.renderTargetOptions)===null||le===void 0?void 0:le.wrapT:ke};if(this._material=t.material,t.renderer?this._renderer=t.renderer:(this._renderer=Mr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Zr,this._camera=new kt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!Ma(this._type,this._renderer,this._camera,re)){let se;switch(this._type){case Me:se=this._renderer.extensions.has("EXT_color_buffer_float")?Oe:void 0;break}se!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Oe}`),this._type=se):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new yr(new Wr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new $r(this.width,this.height,re),this._renderTarget.texture.mapping=((P=t.renderTargetOptions)===null||P===void 0?void 0:P.mapping)!==void 0?(K=t.renderTargetOptions)===null||K===void 0?void 0:K.mapping:hr}static instantiateRenderer(){const t=new Lt;return t.setSize(128,128),t}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const t=Jr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,t),t}toDataTexture(t){const n=new Pt(this.toArray(),this.width,this.height,tr,this._type,t?.mapping||hr,t?.wrapS||ke,t?.wrapT||ke,t?.magFilter||Re,t?.minFilter||Re,t?.anisotropy||1,mr);return n.generateMipmaps=t?.generateMipmaps!==void 0?t?.generateMipmaps:!1,n}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(t){this.disposeOnDemandRenderer(),t&&this.renderTarget.dispose(),this.material instanceof Sr&&Object.values(this.material.uniforms).forEach(n=>{n.value instanceof We&&n.value.dispose()}),Object.values(this.material).forEach(n=>{n instanceof We&&n.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(t){this._width=t,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(t){this._height=t,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(t){this._renderTarget=t,this._width=t.width,this._height=t.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const Ia=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,ba=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class Ta extends Sr{constructor({gamma:t,offsetHdr:n,offsetSdr:u,gainMapMin:c,gainMapMax:v,maxDisplayBoost:h,hdrCapacityMin:y,hdrCapacityMax:g,sdr:f,gainMap:R}){super({name:"GainMapDecoderMaterial",vertexShader:Ia,fragmentShader:ba,uniforms:{sdr:{value:f},gainMap:{value:R},gamma:{value:new Je(1/t[0],1/t[1],1/t[2])},offsetHdr:{value:new Je().fromArray(n)},offsetSdr:{value:new Je().fromArray(u)},gainMapMin:{value:new Je().fromArray(c)},gainMapMax:{value:new Je().fromArray(v)},weightFactor:{value:(Math.log2(h)-y)/(g-y)}},blending:Vt,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=h,this._hdrCapacityMin=y,this._hdrCapacityMax=g,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(t){this.uniforms.sdr.value=t}get gainMap(){return this.uniforms.gainMap.value}set gainMap(t){this.uniforms.gainMap.value=t}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(t){this.uniforms.offsetHdr.value.fromArray(t)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(t){this.uniforms.offsetSdr.value.fromArray(t)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(t){this.uniforms.gainMapMin.value.fromArray(t)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(t){this.uniforms.gainMapMax.value.fromArray(t)}get gamma(){const t=this.uniforms.gamma.value;return[1/t.x,1/t.y,1/t.z]}set gamma(t){const n=this.uniforms.gamma.value;n.x=1/t[0],n.y=1/t[1],n.z=1/t[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(t){this._hdrCapacityMin=t,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(t){this._hdrCapacityMax=t,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(t){this._maxDisplayBoost=Math.max(1,Math.min(65504,t)),this.calculateWeight()}calculateWeight(){const t=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,t))}}class Qr extends Error{}class et extends Error{}const er=(i,t,n)=>{const u=new RegExp(`${t}="([^"]*)"`,"i").exec(i);if(u)return u[1];const c=new RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(i);if(c){const v=c[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return v&&v.length===3?v.map(h=>h.replace(/<\/?rdf:li>/g,"")):c[1].trim()}if(n!==void 0)return n;throw new Error(`Can't find ${t} in gainmap metadata`)},Ca=i=>{let t;typeof TextDecoder<"u"?t=new TextDecoder().decode(i):t=i.toString();let n=t.indexOf("<x:xmpmeta");for(;n!==-1;){const u=t.indexOf("x:xmpmeta>",n),c=t.slice(n,u+10);try{const v=er(c,"hdrgm:GainMapMin","0"),h=er(c,"hdrgm:GainMapMax"),y=er(c,"hdrgm:Gamma","1"),g=er(c,"hdrgm:OffsetSDR","0.015625"),f=er(c,"hdrgm:OffsetHDR","0.015625"),R=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(c),x=R?R[1]:"0",b=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(c);if(!b)throw new Error("Incomplete gainmap metadata");const D=b[1];return{gainMapMin:Array.isArray(v)?v.map(k=>parseFloat(k)):[parseFloat(v),parseFloat(v),parseFloat(v)],gainMapMax:Array.isArray(h)?h.map(k=>parseFloat(k)):[parseFloat(h),parseFloat(h),parseFloat(h)],gamma:Array.isArray(y)?y.map(k=>parseFloat(k)):[parseFloat(y),parseFloat(y),parseFloat(y)],offsetSdr:Array.isArray(g)?g.map(k=>parseFloat(k)):[parseFloat(g),parseFloat(g),parseFloat(g)],offsetHdr:Array.isArray(f)?f.map(k=>parseFloat(k)):[parseFloat(f),parseFloat(f),parseFloat(f)],hdrCapacityMin:parseFloat(x),hdrCapacityMax:parseFloat(D)}}catch{}n=t.indexOf("<x:xmpmeta",u)}};class xa{constructor(t){this.options={debug:t&&t.debug!==void 0?t.debug:!1,extractFII:t&&t.extractFII!==void 0?t.extractFII:!0,extractNonFII:t&&t.extractNonFII!==void 0?t.extractNonFII:!0}}extract(t){return new Promise((n,u)=>{const c=this.options.debug,v=new DataView(t.buffer);if(v.getUint16(0)!==65496){u(new Error("Not a valid jpeg"));return}const h=v.byteLength;let y=2,g=0,f;for(;y<h;){if(++g>250){u(new Error(`Found no marker after ${g} loops 😵`));return}if(v.getUint8(y)!==255){u(new Error(`Not a valid marker at offset 0x${y.toString(16)}, found: 0x${v.getUint8(y).toString(16)}`));return}if(f=v.getUint8(y+1),c&&console.log(`Marker: ${f.toString(16)}`),f===226){c&&console.log("Found APP2 marker (0xffe2)");const R=y+4;if(v.getUint32(R)===1297106432){const x=R+4;let b;if(v.getUint16(x)===18761)b=!1;else if(v.getUint16(x)===19789)b=!0;else{u(new Error("No valid endianness marker found in TIFF header"));return}if(v.getUint16(x+2,!b)!==42){u(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const D=v.getUint32(x+4,!b);if(D<8){u(new Error("Not valid TIFF data! (First offset less than 8)"));return}const k=x+D,le=v.getUint16(k,!b),P=k+2;let K=0;for(let z=P;z<P+12*le;z+=12)v.getUint16(z,!b)===45057&&(K=v.getUint32(z+8,!b));const se=k+2+le*12+4,ce=[];for(let z=se;z<se+K*16;z+=16){const N={MPType:v.getUint32(z,!b),size:v.getUint32(z+4,!b),dataOffset:v.getUint32(z+8,!b),dependantImages:v.getUint32(z+12,!b),start:-1,end:-1,isFII:!1};N.dataOffset?(N.start=x+N.dataOffset,N.isFII=!1):(N.start=0,N.isFII=!0),N.end=N.start+N.size,ce.push(N)}if(this.options.extractNonFII&&ce.length){const z=new Blob([v]),N=[];for(const te of ce){if(te.isFII&&!this.options.extractFII)continue;const S=z.slice(te.start,te.end+1,"image/jpeg");N.push(S)}n(N)}}}y+=2+v.getUint16(y+2)}})}}const Ra=async i=>{const t=Ca(i);if(!t)throw new et("Gain map XMP metadata not found");const u=await new xa({extractFII:!0,extractNonFII:!0}).extract(i);if(u.length!==2)throw new Qr("Gain map recovery image not found");return{sdr:new Uint8Array(await u[0].arrayBuffer()),gainMap:new Uint8Array(await u[1].arrayBuffer()),metadata:t}},Hr=i=>new Promise((t,n)=>{const u=document.createElement("img");u.onload=()=>{t(u)},u.onerror=c=>{n(c)},u.src=URL.createObjectURL(i)});class rt extends $t{constructor(t,n){super(n),t&&(this._renderer=t),this._internalLoadingManager=new Xt}setRenderer(t){return this._renderer=t,this}setRenderTargetOptions(t){return this._renderTargetOptions=t,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const t=new Ta({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new We,sdr:new We});return new Mr({width:16,height:16,type:Me,colorSpace:mr,material:t,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(t,n,u,c){const v=c?new Blob([c],{type:"image/jpeg"}):void 0,h=new Blob([u],{type:"image/jpeg"});let y,g,f=!1;if(typeof createImageBitmap>"u"){const b=await Promise.all([v?Hr(v):Promise.resolve(void 0),Hr(h)]);g=b[0],y=b[1],f=!0}else{const b=await Promise.all([v?createImageBitmap(v,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(h,{imageOrientation:"flipY"})]);g=b[0],y=b[1]}const R=new We(g||new ImageData(2,2),hr,ke,ke,Re,Lr,tr,_r,1,mr);R.flipY=f,R.needsUpdate=!0;const x=new We(y,hr,ke,ke,Re,Lr,tr,_r,1,Yt);x.flipY=f,x.needsUpdate=!0,t.width=y.width,t.height=y.height,t.material.gainMap=R,t.material.sdr=x,t.material.gainMapMin=n.gainMapMin,t.material.gainMapMax=n.gainMapMax,t.material.offsetHdr=n.offsetHdr,t.material.offsetSdr=n.offsetSdr,t.material.gamma=n.gamma,t.material.hdrCapacityMin=n.hdrCapacityMin,t.material.hdrCapacityMax=n.hdrCapacityMax,t.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),t.material.needsUpdate=!0,t.render()}}class Aa extends rt{load([t,n,u],c,v,h){const y=this.prepareQuadRenderer();let g,f,R;const x=async()=>{if(g&&f&&R){try{await this.render(y,R,g,f)}catch(I){this.manager.itemError(t),this.manager.itemError(n),this.manager.itemError(u),typeof h=="function"&&h(I),y.disposeOnDemandRenderer();return}typeof c=="function"&&c(y),this.manager.itemEnd(t),this.manager.itemEnd(n),this.manager.itemEnd(u),y.disposeOnDemandRenderer()}};let b=!0,D=0,k=0,le=!0,P=0,K=0,re=!0,se=0,ce=0;const z=()=>{if(typeof v=="function"){const I=D+P+se,H=k+K+ce,$=b&&le&&re;v(new ProgressEvent("progress",{lengthComputable:$,loaded:H,total:I}))}};this.manager.itemStart(t),this.manager.itemStart(n),this.manager.itemStart(u);const N=new ur(this._internalLoadingManager);N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(this.withCredentials),N.load(t,async I=>{if(typeof I=="string")throw new Error("Invalid sdr buffer");g=I,await x()},I=>{b=I.lengthComputable,k=I.loaded,D=I.total,z()},I=>{this.manager.itemError(t),typeof h=="function"&&h(I)});const te=new ur(this._internalLoadingManager);te.setResponseType("arraybuffer"),te.setRequestHeader(this.requestHeader),te.setPath(this.path),te.setWithCredentials(this.withCredentials),te.load(n,async I=>{if(typeof I=="string")throw new Error("Invalid gainmap buffer");f=I,await x()},I=>{le=I.lengthComputable,K=I.loaded,P=I.total,z()},I=>{this.manager.itemError(n),typeof h=="function"&&h(I)});const S=new ur(this._internalLoadingManager);return S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(u,async I=>{if(typeof I!="string")throw new Error("Invalid metadata string");R=JSON.parse(I),await x()},I=>{re=I.lengthComputable,ce=I.loaded,se=I.total,z()},I=>{this.manager.itemError(u),typeof h=="function"&&h(I)}),y}}class Fa extends rt{load(t,n,u,c){const v=this.prepareQuadRenderer(),h=new ur(this._internalLoadingManager);return h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setPath(this.path),h.setWithCredentials(this.withCredentials),this.manager.itemStart(t),h.load(t,async y=>{if(typeof y=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const g=new Uint8Array(y);let f,R,x;try{const b=await Ra(g);f=b.sdr,R=b.gainMap,x=b.metadata}catch(b){if(b instanceof et||b instanceof Qr)console.warn(`Failure to reconstruct an HDR image from ${t}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),x={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},f=g;else throw b}try{await this.render(v,x,f,R)}catch(b){this.manager.itemError(t),typeof c=="function"&&c(b),v.disposeOnDemandRenderer();return}typeof n=="function"&&n(v),this.manager.itemEnd(t),v.disposeOnDemandRenderer()},u,y=>{this.manager.itemError(t),typeof c=="function"&&c(y)}),v}}const nr={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},tt="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",$e=i=>Array.isArray(i),Ir=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function dr({files:i=Ir,path:t="",preset:n=void 0,colorSpace:u=void 0,extensions:c}={}){n&&(br(n),i=nr[n],t=tt);const v=$e(i),{extension:h,isCubemap:y}=Tr(i),g=Cr(h);if(!g)throw new Error("useEnvironment: Unrecognized file extension: "+i);const f=ar(D=>D.gl);Z.useLayoutEffect(()=>{if(h!=="webp"&&h!=="jpg"&&h!=="jpeg")return;function D(){vr.clear(g,v?[i]:i)}f.domElement.addEventListener("webglcontextlost",D,{once:!0})},[i,f.domElement]);const R=vr(g,v?[i]:i,D=>{(h==="webp"||h==="jpg"||h==="jpeg")&&D.setRenderer(f),D.setPath==null||D.setPath(t),c&&c(D)});let x=v?R[0]:R;if(h==="jpg"||h==="jpeg"||h==="webp"){var b;x=(b=x.renderTarget)==null?void 0:b.texture}return x.mapping=y?jt:qt,x.colorSpace=u??(y?"srgb":"srgb-linear"),x}const Ua={files:Ir,path:"",preset:void 0,extensions:void 0};dr.preload=i=>{const t={...Ua,...i};let{files:n,path:u=""}=t;const{preset:c,extensions:v}=t;c&&(br(c),n=nr[c],u=tt);const{extension:h}=Tr(n);if(h==="webp"||h==="jpg"||h==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const y=Cr(h);if(!y)throw new Error("useEnvironment: Unrecognized file extension: "+n);vr.preload(y,$e(n)?[n]:n,g=>{g.setPath==null||g.setPath(u),v&&v(g)})};const Oa={files:Ir,preset:void 0};dr.clear=i=>{const t={...Oa,...i};let{files:n}=t;const{preset:u}=t;u&&(br(u),n=nr[u]);const{extension:c}=Tr(n),v=Cr(c);if(!v)throw new Error("useEnvironment: Unrecognized file extension: "+n);vr.clear(v,$e(n)?[n]:n)};function br(i){if(!(i in nr))throw new Error("Preset must be one of: "+Object.keys(nr).join(", "))}function Tr(i){var t;const n=$e(i)&&i.length===6,u=$e(i)&&i.length===3&&i.some(h=>h.endsWith("json")),c=$e(i)?i[0]:i;return{extension:n?"cube":u?"webp":c.startsWith("data:application/exr")?"exr":c.startsWith("data:application/hdr")?"hdr":c.startsWith("data:image/jpeg")?"jpg":(t=c.split(".").pop())==null||(t=t.split("?"))==null||(t=t.shift())==null?void 0:t.toLowerCase(),isCubemap:n,isGainmap:u}}function Cr(i){return i==="cube"?Kt:i==="hdr"?ya:i==="exr"?Sa:i==="jpg"||i==="jpeg"?Fa:i==="webp"?Aa:null}const Na=i=>i.current&&i.current.isScene,Ba=i=>Na(i)?i.current:i;function xr(i,t,n,u,c={}){var v,h,y,g;c={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...c};const f=Ba(t||n),R=f.background,x=f.environment,b={backgroundBlurriness:f.backgroundBlurriness,backgroundIntensity:f.backgroundIntensity,backgroundRotation:(v=(h=f.backgroundRotation)==null||h.clone==null?void 0:h.clone())!==null&&v!==void 0?v:[0,0,0],environmentIntensity:f.environmentIntensity,environmentRotation:(y=(g=f.environmentRotation)==null||g.clone==null?void 0:g.clone())!==null&&y!==void 0?y:[0,0,0]};return i!=="only"&&(f.environment=u),i&&(f.background=u),Pr(f,c),()=>{i!=="only"&&(f.environment=x),i&&(f.background=R),Pr(f,b)}}function Rr({scene:i,background:t=!1,map:n,...u}){const c=ar(v=>v.scene);return Z.useLayoutEffect(()=>{if(n)return xr(t,i,c,n,u)}),null}function at({background:i=!1,scene:t,blur:n,backgroundBlurriness:u,backgroundIntensity:c,backgroundRotation:v,environmentIntensity:h,environmentRotation:y,...g}){const f=dr(g),R=ar(x=>x.scene);return Z.useLayoutEffect(()=>xr(i,t,R,f,{backgroundBlurriness:n??u,backgroundIntensity:c,backgroundRotation:v,environmentIntensity:h,environmentRotation:y})),Z.useEffect(()=>()=>{f.dispose()},[f]),null}function Da({children:i,near:t=.1,far:n=1e3,resolution:u=256,frames:c=1,map:v,background:h=!1,blur:y,backgroundBlurriness:g,backgroundIntensity:f,backgroundRotation:R,environmentIntensity:x,environmentRotation:b,scene:D,files:k,path:le,preset:P=void 0,extensions:K}){const re=ar(S=>S.gl),se=ar(S=>S.scene),ce=Z.useRef(null),[z]=Z.useState(()=>new Zr),N=Z.useMemo(()=>{const S=new ea(u);return S.texture.type=Me,S},[u]);Z.useEffect(()=>()=>{N.dispose()},[N]),Z.useLayoutEffect(()=>{if(c===1){const S=re.autoClear;re.autoClear=!0,ce.current.update(re,z),re.autoClear=S}return xr(h,D,se,N.texture,{backgroundBlurriness:y??g,backgroundIntensity:f,backgroundRotation:R,environmentIntensity:x,environmentRotation:b})},[i,z,N.texture,D,se,h,c,re]);let te=1;return ra(()=>{if(c===1/0||te<c){const S=re.autoClear;re.autoClear=!0,ce.current.update(re,z),re.autoClear=S,te++}}),Z.createElement(Z.Fragment,null,ta(Z.createElement(Z.Fragment,null,i,Z.createElement("cubeCamera",{ref:ce,args:[t,n,N]}),k||P?Z.createElement(at,{background:!0,files:k,preset:P,path:le,extensions:K}):v?Z.createElement(Rr,{background:!0,map:v,extensions:K}):null),z))}function ka(i){var t,n,u,c;const v=dr(i),h=i.map||v;Z.useMemo(()=>Jt({GroundProjectedEnvImpl:Ea}),[]),Z.useEffect(()=>()=>{v.dispose()},[v]);const y=Z.useMemo(()=>[h],[h]),g=(t=i.ground)==null?void 0:t.height,f=(n=i.ground)==null?void 0:n.radius,R=(u=(c=i.ground)==null?void 0:c.scale)!==null&&u!==void 0?u:1e3;return Z.createElement(Z.Fragment,null,Z.createElement(Rr,Qt({},i,{map:h})),Z.createElement("groundProjectedEnvImpl",{args:y,scale:R,height:g,radius:f}))}function La(i){return i.ground?Z.createElement(ka,i):i.map?Z.createElement(Rr,i):i.children?Z.createElement(Da,i):Z.createElement(at,i)}function Pa({activeIndex:i}){const{scene:t}=aa("/models/di_03.glb");return Z.useEffect(()=>{t.traverse(n=>{n.isMesh&&n.name.startsWith("Variant_")&&(n.visible=n.name===`Variant_${i+1}`)})},[t,i]),_e.jsx("primitive",{object:t,scale:1.8,position:[0,-.3,0]})}const Ha="_viewerWrapper_dl8l1_1",za="_canvasBox_dl8l1_15",Ga="_controls_dl8l1_35",Za="_themes_dl8l1_47",Wa="_btn_dl8l1_61",$a="_activeBtn_dl8l1_87",Ge={viewerWrapper:Ha,canvasBox:za,controls:Ga,themes:Za,btn:Wa,activeBtn:$a},Xa=[{label:"Studio",preset:"studio"},{label:"City",preset:"city"},{label:"Warehouse",preset:"warehouse"},{label:"Park",preset:"park"}];function ja(){const[i,t]=Z.useState(0),[n,u]=Z.useState("studio");return _e.jsxs("div",{className:Ge.viewerWrapper,children:[_e.jsx("div",{className:Ge.canvasBox,children:_e.jsxs(na,{camera:{position:[0,0,2.5],fov:45},children:[_e.jsx("ambientLight",{intensity:.5}),_e.jsx("directionalLight",{position:[0,5,5],intensity:1}),_e.jsx(La,{preset:n}),_e.jsx(Pa,{activeIndex:i}),_e.jsx(ia,{autoRotate:!0,enableZoom:!0,enablePan:!0})]})}),_e.jsxs("div",{className:Ge.controls,children:[_e.jsx("h3",{children:"Theme Presets"}),_e.jsx("div",{className:Ge.themes,children:Xa.map(c=>_e.jsx("button",{className:n===c.preset?Ge.activeBtn:Ge.btn,onClick:()=>u(c.preset),children:c.label},c.preset))})]})]})}export{ja as default};
